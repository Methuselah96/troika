/*!
Custom bundle of @unicode-font-resolver/client v0.3.1 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/
export default function(){return function(t){"use strict";class e{constructor(){this.buckets=new Map}add(t){const e=t>>5;this.buckets.set(e,(this.buckets.get(e)||0)|1<<(31&t))}has(t){const e=this.buckets.get(t>>5);return void 0!==e&&0!=(e&1<<(31&t))}serialize(){const t=[];return this.buckets.forEach(((e,n)=>{t.push(`${(+n).toString(36)}:${e.toString(36)}`)})),t.join(",")}deserialize(t){this.buckets.clear(),t.split(",").forEach((t=>{const e=t.split(":");this.buckets.set(parseInt(e[0],36),parseInt(e[1],36))}))}}const n=Math.pow(2,8),r=n-1,o=~r;function s(t){const e=function(t){return t&o}(t).toString(16),r=function(t){return(t&o)+n-1}(t).toString(16);return`codepoint-index/plane${function(t){return(16711680&t)/65536}(t)}/${e}-${r}.json`}function i(t,e){const n=t&r;let o=e.codePointAt(n/6|0);return o=(o||48)-48,0!=(o&1<<n%6)}function c(t,e){var n;(n=t,n.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((t=>t.split("-").map((t=>parseInt(t.trim(),16)))))).forEach((([t,n=t])=>{e(t,n)}))}function l(t,e){c(t,((t,n)=>{for(let r=t;r<=n;r++)e(r)}))}let a={},u={};const f=new WeakMap;function h(t){let n=f.get(t);return n||(n=new e,l(t.ranges,(t=>n.add(t))),f.set(t,n)),n}const d=new Map;function g(t){let e=d.get(t);return e||(e=fetch(t).then((t=>t.json())),d.set(t,e)),e}function p(t,e,n){return t[e]?e:t[n]?n:function(t){for(const e in t)return e}(t)}function $(t,e){let n=e;if(!t.includes(n)){n=1/0;for(let r in t)Math.abs(+r-e)<Math.abs(n-e)&&(n=+r)}return n}let v;function w(t){return v||(v=new Set,l("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(t=>{v.add(t)}))),v.has(t)}return t.CodePointSet=e,t.clearCache=function(){a={},u={}},t.getFontsForString=function(t,e={}){const{lang:n="en",category:r="sans-serif",style:o="normal",weight:c=400}=e,l=(e.dataUrl||"https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v0.3.0/packages/data").replace(/\/$/g,""),f=new Map,d=new Uint8Array(t.length),v={},b={},k=new Array(t.length),m=new Map;for(let e=0;e<t.length;e++){const n=t.codePointAt(e),r=s(n);k[e]=r,a[r]||m.has(r)||m.set(r,g(`${l}/${r}`).then((t=>{a[r]=t}))),n>65535&&e++}return Promise.all(m.values()).then((()=>{m.clear();for(let e=0;e<t.length;e++){const r=t.codePointAt(e);let o=null;const s=a[k[e]];t:for(let t in s){let e=b[t];if(void 0===e&&(e=b[t]=new RegExp(t).test(n)),e)for(let e in s[t])if(i(r,s[t][e])){o=e;break t}}o||(console.debug(`No font coverage for U+${r.toString(16)}`),o="latin"),k[e]=o,u[o]||m.has(o)||m.set(o,g(`${l}/font-meta/${o}.json`).then((t=>{u[o]=t}))),r>65535&&e++}return Promise.all(m.values())})).then((()=>{var e;let n=null;for(let s=0;s<t.length;s++){const i=t.codePointAt(s);if(n&&(w(i)||h(n).has(i)))d[s]=d[s-1];else{n=u[k[s]];let t=v[n.id];if(!t){const{typeforms:s}=n,i=p(s,r,"sans-serif"),a=p(s[i],o,"normal"),u=$(null===(e=s[i])||void 0===e?void 0:e[a],c);t=v[n.id]=`${l}/font-files/${n.id}/${i}.${a}.${u}.woff`}let i=f.get(t);null==i&&(i=f.size,f.set(t,i)),d[s]=i}i>65535&&(s++,d[s]=d[s-1])}return{fontUrls:Array.from(f.keys()),chars:d}}))},Object.defineProperty(t,"__esModule",{value:!0}),t}({})}
